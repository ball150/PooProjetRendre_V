{% extends "base_dashboard.html" %}
{% block title %}Fiche de suivi p√©dagogique{% endblock %}

{% block content %}

<div class="container">
    <!-- En-t√™te Universit√© -->
    <div class="fiche-header mb-2 text-center">
        UNIVERSIT√â IBA DER THIAM DE THI√àS<br>
        <small>UFR SCIENCE DE L'INGENIEUR<br>
        D√âPARTEMENT GENIE CIVIL</small>
    </div>
    <!-- Titre fiche -->
    <div class="text-center my-4">
        <h3>üìÑ FICHE DE SUIVI P√âDAGOGIQUE</h3>
        <p class="text-muted mb-1">Suivi du cours et validation des s√©ances</p>
    </div>

    <!-- Informations g√©n√©rales sous forme de cartes -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm p-3 text-center">
                <div class="fw-bold mb-1">üéì Fili√®re</div>
                <div class="fw-bold mb-1">Geomatique</div>

            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm p-3 text-center">
                <div class="fw-bold mb-1">üìö Cours</div>
                <div>{{ cours.nom }}</div>
                <div class="fw-bold mb-1">üéì Annees</div>
                <div class="fw-bold mb-1">2024-2025</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm p-3 text-center">
                <div class="fw-bold mb-1">üë®‚Äçüè´ Enseignant</div>
                <div>{{ cours.enseignant }}</div>
                <div class="mt-2 text-muted"><small><b>Volume horaire :</b> {{ cours.volume_horaire }}</small></div>
            </div>
        </div>
    </div>

    <!-- R√©sum√© des s√©ances (optionnel, si tu veux un mini dashboard) -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm text-center p-2">
                <div class="h3 mb-0">üìÖ</div>
                <span>S√©ances r√©alis√©es</span>
                <div class="fs-4">{{ nb_seances or seances|length }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm text-center p-2">
                <div class="h3 mb-0">‚úÖ</div>
                <span>S√©ances valid√©es</span>
                <div class="fs-4">
                    {{ seances|selectattr("valide")|list|length }}
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm text-center p-2">
                <div class="h3 mb-0">‚è∞</div>
                <span>Heures totales</span>
                <div class="fs-4">
                    {{ seances|sum(attribute='duree') if seances else '--' }}
                </div>
            </div>
        </div>
    </div>

    <!-- Tableau des s√©ances -->
    <div class="table-responsive mb-4">
        <table class="table table-bordered table-striped align-middle shadow-sm">
            <thead>
                <tr class="align-middle">
                    <th>Date</th>
                    <th>Heure d√©but</th>
                    <th>Heure fin</th>
                    <th>Dur√©e</th>
                    <th>Contenu</th>
                    <th>Valid√©e</th>
                </tr>
            </thead>
            <tbody>
                {% if seances %}
                    {% for seance in seances %}
                    <tr>
                        <td>{{ seance.date }}</td>
                        <td>{{ seance.heure_debut }}</td>
                        <td>{{ seance.heure_fin }}</td>
                        <td>{{ seance.duree }}</td>
                        <td>{{ seance.contenu }}</td>
                        <td>
                            {% if seance.valide %}
                                <span class="badge bg-success">Oui</span>
                            {% else %}
                                <span class="badge bg-secondary">Non</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">Aucune s√©ance enregistr√©e pour ce cours.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- Signature -->
    <div class="signature-box mt-5 mb-3">
        <b>Signature de l'enseignant</b><br>
        <span style="display: inline-block; width: 320px; border-bottom: 1px dotted #444; height: 32px;"></span>
    </div>

    <!-- Boutons actions -->
    <div class="d-flex justify-content-center gap-3 mt-4 mb-2 btn-print">
        <button class="btn btn-outline-primary" onclick="window.print()">üñ®Ô∏è Imprimer la fiche</button>
        <a href="{{ url_for('export_excel', cours_id=cours.id) }}" class="btn btn-success">‚¨áÔ∏è Exporter Excel</a>
        <a href="{{ url_for('export_pdf', cours_id=cours.id) }}" class="btn btn-danger">‚¨áÔ∏è Exporter PDF</a>
    </div>
</div>

{% endblock %}
